# 첫번째 삽질

처음 문제를 보고 그냥 for 문 돌리면 되는거 아닌가 싶었음. 게다가 첫번째 문제는 코드도 거의 완성되어 왔기 때문에 뭘 하라는거지? 라는 생각을 함.  

그리고 문제를 커서에 붙여넣고 에이전트에게 코딩해 달라고 했더니 코드를 완성해 버림. 그런데... 이게 문제였음.  

아직 커서를 아주 잘 다루지 못해 이런 저런 다양한 삽질들을 하고 있는 과정이었기 때문에 룰 세팅이나 MCP 설정들도 아직 잘 되어 있지 않은 상황에서 그냥 하다보니 폴더 구조부터 코딩 스타일 등이 맘에들지 않음.  

그래서 과거에 토이 프로젝트로 했던 git repository를 열어 에이전트에게 이 프로젝트의 코드를 기반으로 커서 룰을 작성해 달라고 함.  

놀랍게도 상당히 잘 작성해 줌. 그런데... 뭔가 아쉬웠음....

다시 검색과 유튜브 시청을 통해 다른 사람들이 잘 작성해 놓은 룰이 있는 것을 발견함.

- [커서 룰 Repo](https://github.com/PatrickJS/awesome-cursorrules?tab=readme-ov-file)

여기를 이것 저것 뒤져 에이전트에게 던져주고 다시 내 코드를 기반으로 룰을 작성해 달라고 함.

와..... AI 진짜 미쳤음... 거의 내가 원하는 룰을 잘 작성해 줌... 내가 스스로 했다면 이것보단 못 했을거라 생각함.

그런데 또 뭔가... 마음에 안들었음. 이유는 룰을 언어와 프레임워크, 프로젝트별로 나눠서 범용적으로 사용하고, 재활용 가능하게 하고 싶었음.

그래서 python(삽질 과정 중 자바도 해봄), FastAPI, 프로젝트 단위로 룰을 세분화 함.

여기엔 아래의 룰만 적용함.

- [python rule](.cursor/rules/python-common.mdc)
- [project rule](.cursor/rules/project.mdc)

그리고 다시 에이전트에게 일을 시킴. 일해라 AI!

그래서 새로 만들어진 코드는 상당히 마음에 들었음. 그런데 문제는... 크롤링이 안됨... 아마도 방어 로직에 의해 실패하는 것으로 보임.

그런데 이걸 해결하려고 했던 것이 가장 큰 삽질이었음.

주어진 문제는 크롤링을 실제로 해서 조회수를 가져오는 문제도 있었지만 그냥 for 문 돌려서 response를 가져오면 단순한 문제도 있었는데 둘 다 크롤링에 집중해 버림.

그리고 또 selenium과 proxy는 사용하지 말라는 제약을 나중에 봄.... OTL

아............. 이걸 왜 이틀이나 삽질하고 알았는지......

지금 이 글을 쓰고 있는 시점에서 알아차리고 이제 다시 원점으로 돌아가 코딩을 해야 함. ㅠㅠ

아! 그리고 하나 빼먹었는데 AI가 짜준 코드는 완벽하지 않아 이런 저런 작업을 추가로 더 하긴 했었음.

예를들면 문제로 주어진 URL과 크롤링 시 필요한 여러 설정들을 yaml 파일로 따로 빼도록 한 것.

의존성을 poetry로 관리하도록 변경한 것.

옛날에 작성한 코드들이 부끄러워(내가 짠 과거의 코드들은 다 왜 이리 부끄러운건지...) 깃헙에 공개하지 못하고 있었는데 앞으로 하게 될 과제들은 공개해 보려고 마음먹고 나름 기록을 하고 있음.

## 두번째 삽질

일단 기존에 작성한 코드들을 v1 폴더로 옮긴 후 v2 폴더를 만들어 새로 작성함.

첫번째 문제의 경우 for문만 제대로 돌리면 되는 것으로 이해 해서 논리적인 오류를 해결하는 걸 먼저 하려고 함.

### 첫번째 문제

일단 주어진 코드가 while 문을 통해 5번 반복 하도록 되어 있었음.

개인적으로 이런 코드를 선호하지 않음. 이유는 반복의 횟수나 상태가 명확하지 않아 오류를 양산하기 좋은 방식임.

for 문으로 변경하여 실행하도록 함. 그런데.... url을 1번 호출한 후 무한 대기하는 문제가 있음.

이건 뭐 while 수정한건 상관없이 무한 대기 함... 타임 아웃 설정을 통해 무한 대기하지 않도록 수정함.

일단 문제 자체가 크롤링에 성공하는 것이 아니라 반복만 제대로 되게 만들면 되는 것이라고 생각해 여기서 더 이상 손대지 않기로 함.

어차피 크롤링은 2번 문제가 있으니...

## 두번째 문제

하아.... 많은 일들이 있었는데 요약하자면... 수많은 삽질 후 안되겠다 싶어 전체 코드를 마지막 커밋 기준으로 리셋 했고, 여기에 적었던 삽질의 기록들도 다 날아갔다... 코드만 생각했네 ㅠㅠ

아무튼 삽질들을 요약하자면 API가 있는걸 발견하고 테스트 해봤으나 실패... 검색해보니 API는 비즈니스나 크리에이터가 아니면 다 오류 처리 되는 듯 하여 다시 HTML을 파싱하는 방식으로 구현했음.

그리고 여러 공통 기능들을 utils에 따로 만들어 옮기고 재 사용 하도록 하고, 설정들을 별도로 분리했음.

문제는 구현 과정에서 패키지 구조 문제로 실행이 원활히 되지 않아 구현과 상관없는 이런 저런 변경 시도 끝에 리셋... 그리고 해야 하는 상태다. 커밋 좀 자주 할껄... ㅠㅠ

일단 공통 기능 분리 후 첫번째 문제에 적용하고, 정상 동작하는 걸 확인 후 커밋 함.

다시 인스타그램 크롤링을 위한 코드를 작성했음. 실패

이유는 크롤링을 방지하기 위한 매커니즘이 있는 듯. 이를 회피하기 위해 다양한 UA와 레퍼러, 일정하지 않은 지연시간과 재시도, 쿠키 저장 및 로드등의 기능을 삽질의 반복 끝에 구현함. 실패

어찌저찌하여 200 응답은 받아오는데 성공 했는데 정상적인 HTML을 응답으로 받아오지 못함. 알아볼 수 없는 외계어를 받아옴.... 바이너리인가...

다시 삽질 끝에 HTML 파일을 얻는데 성공... 압축이 문제인듯... 그런데 이거 왜 아무것도 안보이는 거냐... OTL

이건 로그인을 해야 해결될 것으로 보이는데 삽질 기록도 코드 리셋하면서 날라가서 다시 쓰자면 나는 인스타그램을 하지 않는다.

예전에 몇번 보는 용도로 웹에서 페북 아이디로 로그인했던 적은 있지만 너무 오래전이었고, 크롤링 코드 짜면서 로그인 해볼까 했는데 인증코드를 WhatsApp으로 보낸다고 한다.... SMS로 보내기 선택하고 보냈는데 안 온다...

아무튼 그래서 로그인 하지 못하고 그냥 개발하다 코드를 리셋하게 됐다. ㅠㅠ

아.... 이걸 작성하면서 혹시 문자가 스팸처리 됐나 싶어 봤더니 역시나... ㅠㅠ

웹에서 로그인 했으니 다시 로그인 해서 크롤링 하는걸 해봐야겠다. 내 아이디가 뭐였더라... ㅠㅠ

기존 계정은 페북으로 가입해 아이디/패스워드 로그인 테스트가 안돼서 새로 가입했다.

## 코드 다듬기

코딩한지 워낙 오래돼서 내가 하던것도 다 까먹었나보다... 뒤늦게 타입이 신경쓰여 v2 전체 코드에 타입을 선언했다.

그리고 삽질 과정에선 비동기로 구현했었는데 다 갈아엎고 다시 하면서 그냥 했더니 느리다... 이걸 고쳐 말어 고민하다 시간이 많이 남지 않아 손대지 않기로 했다.

혹시나 실행이 나만 잘될까 싶어 실행 결과도 저장하게 변경했다.

커서가 vsCode 기반이다 보니 파이참처럼 각각의 프로젝트를 가상화 해서 별도의 개발 환경 보장이 안되는 것 같다. (내가 모르는걸수도...)

시간 나면 이것도 좀 확인해 봐야겠다.